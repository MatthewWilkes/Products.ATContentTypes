<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body>

    <div metal:fill-slot="main">
    <metal:body define-macro="body_macro">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>

        <div metal:use-macro="here/document_actions/macros/document_actions">
             Document actions (print, sendto etc)
        </div>

        <a href=""
           class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">
        Up one level
        </a>

        <div class="documentDescription" tal:content="structure here/Description">
            description
        </div>

        <metal:listingmacro define-macro="listing">

        <tal:topiccontents define="topicContents here/queryCatalog">
        <tal:listing condition="topicContents">
        <a style='text-align: right' href="#"
           tal:condition="nocall: here/asPDF|nothing"
           tal:attributes="href string:${here_url}/asPDF/atct_topic_pdf_template/atct_topic_pdf">
                    Download PDF
        </a>
        <tal:default condition="not:here/getCustomView|nothing">

            <dl>
            <tal:brain repeat="obj topicContents">
                <dt metal:define-macro="list-item"
                    tal:define="url obj/getURL;
                                obj_type obj/portal_type;
                                obj_typeinfo python: here.portal_types.getTypeInfo(obj_type);
                                icon python:portal_url+'/'+ obj_typeinfo.getIcon();
                                title_or_id python:obj.Title or obj.getId">
                <a href="#" tal:attributes="href url">
                    <img src="#"
                     height="16"
                     width="16"
                     alt=""
                     tal:attributes="src icon"/>
                </a>

                <a href="#" tal:condition="python:obj.portal_type not in ['Link', 'Image']"
                            tal:attributes="href url"
                            tal:content="title_or_id" />

                <a href="#" tal:condition="python:obj.portal_type == 'Image'"
                            tal:attributes="href string:${url}/view"
                            tal:content="title_or_id" />

                <a href="#" 
                   tal:condition="python:obj.portal_type == 'Link'"
                   tal:attributes="href obj/getRemoteUrl;"
                   class="link-plain"
                   tal:content="title_or_id" />

                <span class="discreet"
                      tal:condition="python:obj.portal_type == 'Event'">
    
                    &nbsp;
                    <span tal:replace="obj/location">Oslo</span>,
                    <span tal:replace="obj/start/ISO|obj/StartDate">from date</span> -
                    <span tal:replace="obj/end/ISO|obj/EndDate">to date</span>

                </span>
                </dt>

                <dd>
                    <span tal:content="structure python:test(obj.Description, obj.Description, '&nbsp;')"> description </span>
                </dd>
            </tal:brain>
            </dl>

        </tal:default>

        <tal:custom condition="here/getCustomView|nothing"
                    define="vocab python:here.listMetaDataFields(False)">
            <table class="listing"
                   summary="Content listing"
                   cellpadding="0" cellspacing="0" width="100%">
                 <thead>
                    <tr>
                        <th tal:repeat="field here/getCustomViewFields"
                            tal:content="python:vocab.getValue(field, field)"/>
                    </tr>
                 </thead>
                 <tbody>
                    <tal:brain tal:repeat="obj topicContents">
                    <tr tal:define="oddrow repeat/obj/odd;"
                        tal:attributes="class python:test(oddrow, 'even', 'odd')">
                        <tal:fields repeat="field here/getCustomViewFields"
                                    define="url obj/getURL;
                                            obj_type obj/portal_type;
                                            obj_typeinfo python: here.portal_types.getTypeInfo(obj_type);
                                            icon python:portal_url+'/'+ obj_typeinfo.getIcon();
                                            title_or_id python:obj.Title or obj.getId">
                        <tal:block define="value python: getattr(obj, field, None);
                        dictish nocall:value/items|nothing;
                        listish python:same_type(value,[]) or same_type(value,())">
                            <td tal:condition="python: field != 'Title' and not (listish or dictish)"
                                tal:content="value"/>
                            <td tal:condition="python: field != 'Title' and listish"
                                tal:content="python: ', '.join(value)"/>
                            <td tal:condition="python: field != 'Title' and dictish"
                                tal:content="python: ', '.join(['%s: %s'%(a,b) for a,b in value.items()])"/>
                            <td tal:condition="python: field == 'Title'">
                                <a href="#" tal:attributes="href url">
                                    <img src="#"
                                         height="16"
                                         width="16"
                                         tal:attributes="src icon"/>
                                </a>

                                <a href="#" tal:condition="python: obj.portal_type not in ['Link', 'Image']"
                                            tal:attributes="href url"
                                            tal:content="title_or_id" />

                                <a href="#" tal:condition="python: obj.portal_type == 'Image'"
                                            tal:attributes="href string:${url}/view"
                                            tal:content="title_or_id" />

                                <a href="#"
                                   tal:condition="python: obj.portal_type == 'Link'"
                                   tal:attributes="href obj/getRemoteUrl;"
                                   class="link-plain"
                                   tal:content="title_or_id" />
                            </td>
                        </tal:block>
                        </tal:fields>

                    </tr>
                    </tal:brain>
                 </tbody>
            </table>
        </tal:custom>

        </tal:listing>
        
        <p class="discreet"
           tal:condition="not: topicContents" i18n:translate="description_no_items_in_topic">
         There are currently no results for this topic search.
        </p>

        </tal:topiccontents>
        </metal:listingmacro>
    </metal:body>
    <metal:body define-macro="folderlisting_macro">
        <tal:subtopics>
            <h2>Sub-topics:</h2>
            <metal:list metal:use-macro="here/base/macros/folderlisting"/>
        </tal:subtopics>
    </metal:body>
    </div>

</body>
</html>

